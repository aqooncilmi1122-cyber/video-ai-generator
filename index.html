<script>
  // Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø¹Ù„Ù‰ Render
  const API_URL = "https://video-ai-backend-figu.onrender.com";

  // Ù‚Ø§Ø¦Ù…Ø© Ù„Ø­ÙØ¸ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§
  const videos = [];

  async function handleGenerate() {
    const scriptText = document.getElementById("script").value.trim();
    const language = document.getElementById("language").value;
    const length = document.getElementById("length").value;
    const statusBox = document.getElementById("status");

    if (!scriptText) {
      statusBox.innerHTML =
        '<div class="dot"></div><div>Please write your script first.</div>';
      return;
    }

    const langMap = {
      ar: "Arabic",
      en: "English",
      so: "Somali",
      sv: "Swedish",
    };

    const lengthText =
      length === "30"
        ? "30 sec"
        : length === "60"
        ? "1 min"
        : Math.round(length / 60) + " min";

    statusBox.innerHTML =
      '<div class="dot"></div><div><strong>Generatingâ€¦</strong><br />Please wait while we create your videoâ€¦</div>';

    try {
      const res = await fetch(API_URL + "/api/generate-video", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          script: scriptText,
          language,
          length_seconds: Number(length),
          voice: true,
        }),
      });

      const data = await res.json();

      if (!res.ok || data.error) {
        statusBox.innerHTML =
          '<div class="dot"></div><div>âŒ Error: ' +
          (data.error || "Server error") +
          "</div>";
        return;
      }

      const videoUrl = data.videoUrl;

      // Ù†Ø®Ø²Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯
      videos.unshift({
        url: videoUrl,
        language: langMap[language],
        lengthText,
      });

      statusBox.innerHTML =
        '<div class="dot"></div><div>' +
        "<strong>âœ… Video created successfully!</strong><br /><br />" +
        "Language: " +
        langMap[language] +
        " Â· Length: " +
        lengthText +
        "<br /><br />" +
        '<video controls style="width:100%;border-radius:12px;"><source src="' +
        videoUrl +
        '" type="video/mp4"></video><br /><br />' +
        '<a href="' +
        videoUrl +
        '" download>â¬‡ Download video</a><br /><br />' +
        "Open <strong>My Videos</strong> to see all generated videos." +
        "</div>";
    } catch (err) {
      statusBox.innerHTML =
        '<div class="dot"></div><div>âŒ Network error: ' +
        err.message +
        "</div>";
    }
  }

  function handleOpenGallery() {
    const statusBox = document.getElementById("status");
    if (!videos.length) {
      statusBox.innerHTML =
        '<div class="dot"></div><div><strong>My Videos</strong><br />No videos yet. Generate one first.</div>';
      return;
    }

    let html = '<div class="dot"></div><div><strong>My Videos</strong><br /><br />';
    videos.forEach((v, i) => {
      html +=
        "ğŸ”¹ Video " +
        (i + 1) +
        " â€“ " +
        v.language +
        " Â· " +
        v.lengthText +
        "<br />" +
        '<video controls style="width:100%;border-radius:12px;margin:6px 0;"><source src="' +
        v.url +
        '" type="video/mp4"></video>' +
        '<a href="' +
        v.url +
        '" download>â¬‡ Download</a><br /><br />';
    });
    html += "</div>";

    statusBox.innerHTML = html;
  }
</script>
